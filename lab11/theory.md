# Триггеры (теория)
## Что это?
При работе с базой данных нам иногда хочется автоматизировать некоторые действия, которые должны всегда выполняться при работе с таблицами. Например, какие-то базовые проверки или дополнительные манипуляции, невидимые для внешнего пользователя. Это можно сделать с помощью триггеров.

Триггер - это уже известная нам процедура с одним важным отличием: она умеет автоматически запускаться в определенные моменты времени. В частности, как мы помним, у нас есть три операции корректировки данных: добавление (insert), обновление (update) и удаление (delete) записи из таблицы. И триггер можно настроить так, чтобы он срабатывал до или после каких-то операций из этого списка. Например, можно сделать триггер, проверяющий добавляемые в таблицу данные на корректность - он будет срабатывать до любой операции insert.
 
## Как создать?
Нажимаем правой кнопкой мыши на вкладку `Triggers` и в выпадающем меню выбираем `New Trigger...`:

![](https://github.com/NikitaBogoslovskiy/DatabaseCourse/blob/main/lab11/materials/create_trigger.jpg)

Далее мы переходим в жесткий режим программиста, чтобы писать триггер в виде кода (опять же всегда можно использовать графический интерфейс для настройки триггера, просто в данном документе мы будем делать это через код):

![](https://github.com/NikitaBogoslovskiy/DatabaseCourse/blob/main/lab11/materials/go_to_manual_mode.jpg)

Перед нами будет следующая заготовка:
```sql
CREATE OR ALTER trigger new_trigger for 
active before insert position 0
AS
begin
  /* Trigger text */
end
```
Первые две строки кода позволяют нам выполнить настройку триггера:
```sql
CREATE OR ALTER trigger new_trigger for 
active before insert position 0
```
Рассмотрим в подробности каждый кусочек:
1. Выражение `CREATE OR ALTER trigger new_trigger` определяет создание триггера с именем `new_trigger`. Здесь мы можем поставить любое свое имя. Чуть позже в примерах будет разобрано, какие имена лучше ставить.
2. Ключевое слово `for` задает таблицу, работу с которой мы будем обрабатывать. Например, мы хотим отлавливать все изменения, связанные с таблицей операций `Operation`. Тогда нужно написать `for operation`.
3. Слово `active` определяет активность триггера. По умолчанию он всегда активен, и мы менять этого в дальнейшем не будем - но если вдруг это нужно, то можно написать `inactive`, то есть сделать неактивным, выключить.
4. `before` определяет порядок сработки триггера -  сработает он до или после корректировки данных в таблице. В наших задачах чаще будет использоваться сработка триггера до, то есть `before` (чуть позже в примерах будет рассмотрено, почему), но иногда может пригодиться и `after`, то есть какая-то логика, идущая после работы с таблицей.
5. `insert` определяет тип операции, на который триггер будет срабатывать. Здесь может быть добавление записи `insert`, изменение записи `update` и удаление `delete`. Если мы хотим фиксировать несколько операций сразу, то между типами пишется `or` - например, при отлавливании добавления и изменения записи будем писать `insert or update`.
6. `position 0` определяет очередность сработки триггера, которая играет роль, если должны сработать несколько триггеров сразу. По умолчанию, стоит нулевая позиция в очереди, и в рамках примеров мы менять этого не будем.

Если отбросить задание активности триггера и его позицию в очереди на срабатывание, то настройка триггера сводится к четырем пунктам:
1. Определить таблицу, изменения в которой мы отлавливаем
2. Определить тип операции, на котором будет срабатывать триггер
3. Определить порядок сработки - до или после изменений
4. Дать имя (почему это идет в конце - узнаете в примерах)

Сама логика обработки будет подробнее рассмотрена в разделе [Примеры (практика)](https://github.com/NikitaBogoslovskiy/DatabaseCourse/blob/main/lab11/practice.md), поэтому на текущий момент имеем:
```sql
CREATE OR ALTER trigger new_trigger for operation
active before insert position 0
AS
begin
  /* Будущий код триггера, его основная логика */
end
```

